var p=Object.defineProperty;var y=(g,e,t)=>e in g?p(g,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):g[e]=t;var o=(g,e,t)=>y(g,typeof e!="symbol"?e+"":e,t);import{L as T}from"./chunk-CZRYylKx.js";import{M as n,a as h}from"./chunk-DwgIagi8.js";const u=class u{constructor(){o(this,"baseUrl");o(this,"logger");o(this,"accessToken",null);o(this,"refreshToken",null);o(this,"tokenExpiresAt",null);o(this,"initializationPromise",null);o(this,"cachedUser",null);o(this,"lastRefreshTime",0);o(this,"isRefreshing",!1);o(this,"refreshPromise",null);this.baseUrl="https://ext.vocay.com",this.logger=new T("[APIClient]"),this.logger.info(`Initialized with baseUrl: ${this.baseUrl}`),this.initializationPromise=this.loadTokensFromStorage()}static getInstance(){return u.instance||(u.instance=new u),u.instance}async waitForInitialization(){this.initializationPromise&&(await this.initializationPromise,this.initializationPromise=null)}async translate(e){return this.logger.debug("translate() called with:",e),await this.request("/api/translate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}async lookupWord(e){return this.logger.debug("lookupWord() called with:",e),await this.request("/api/dictionary/lookup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}async lookupEntry(e,t,a="zh-CN",r,s){this.logger.debug("lookupEntry() called with:",{word:e,lang_code:t,native_lang_code:a,source:r,pos:s});const i=new URLSearchParams({word:e,lang_code:t,native_lang_code:a});r&&i.append("source",r),s&&i.append("pos",s);try{return await this.request(`/api/dictionary/entry?${i.toString()}`,{method:"GET"},1)}catch(c){if(c instanceof Error&&c.message.includes("404"))return this.logger.info(`Entry not found: ${e} (${t})`),null;throw c}}async analyzeText(e){return this.logger.debug("analyzeText() called with:",e),await this.request("/api/nlp/analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}async extractPhrases(e){return this.logger.debug("extractPhrases() called with:",e),await this.request("/api/nlp/extract-phrases",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}async detectLanguage(e){return this.logger.debug("detectLanguage() called with:",e),await this.request("/api/nlp/detect-language",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}async register(e){return this.logger.debug("register() called with:",{email:e.email}),await this.request("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},1)}async login(e){this.logger.debug("login() called with:",{email:e.email});const t=await this.request("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},1);return await this.setTokens(t),t}async logout(){if(this.logger.debug("logout() called"),!this.refreshToken){this.logger.warn("No refresh token found, cannot logout");return}try{await this.request("/api/auth/logout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:this.refreshToken})},1)}finally{await this.clearTokens()}}async refreshAccessToken(){if(this.logger.debug("refreshAccessToken() called"),!this.refreshToken)throw new Error("No refresh token available");const e=await this.request("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:this.refreshToken})},1);return await this.setTokens(e),e}async getCurrentUser(){this.logger.debug("getCurrentUser() called");const e=await this.request("/api/auth/me",{method:"GET"});return await this.cacheUser(e),e}getCachedUser(){return this.cachedUser}async isAuthenticated(){return this.accessToken?this.isTokenExpired()?this.refreshToken?Date.now()-this.lastRefreshTime<5*60*1e3?(this.logger.debug("Token refreshed recently, skipping refresh"),!0):this.isRefreshing&&this.refreshPromise?(this.logger.debug("Token refresh already in progress, waiting..."),await this.refreshPromise):(this.isRefreshing=!0,this.refreshPromise=(async()=>{try{return this.logger.info("Access token expired, attempting to refresh..."),await this.refreshAccessToken(),this.lastRefreshTime=Date.now(),this.logger.info("Token refresh successful"),!0}catch(t){return this.logger.error("Token refresh failed:",t),await this.clearTokens(),!1}finally{this.isRefreshing=!1,this.refreshPromise=null}})(),await this.refreshPromise):(this.logger.warn("Access token expired and no refresh token available"),!1):!0:!1}getAccessToken(){return this.accessToken}async addVideoView(e){return this.logger.debug("addVideoView() called with:",{video_id:e.video_id,platform:e.platform}),await this.request("/api/video-views",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},1)}async getVideoView(e){return this.logger.debug("getVideoView() called with:",{videoViewId:e}),await this.request(`/api/video-views/${e}`,{method:"GET"})}async listVideoViews(e){this.logger.debug("listVideoViews() called with:",e);const t=new URLSearchParams;(e==null?void 0:e.skip)!==void 0&&t.append("skip",e.skip.toString()),(e==null?void 0:e.limit)!==void 0&&t.append("limit",e.limit.toString());const a=t.toString()?`/api/video-views?${t.toString()}`:"/api/video-views";return await this.request(a,{method:"GET"})}async createVideoCollection(e){return this.logger.debug("createVideoCollection() called with:",{word:e.word,video_view_id:e.video_view_id}),await this.request("/api/video-collections",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},1)}async getVideoCollections(e){this.logger.debug("getVideoCollections() called with:",e);const t=new URLSearchParams;(e==null?void 0:e.skip)!==void 0&&t.append("skip",e.skip.toString()),(e==null?void 0:e.limit)!==void 0&&t.append("limit",e.limit.toString()),(e==null?void 0:e.video_view_id)!==void 0&&t.append("video_view_id",e.video_view_id.toString()),e!=null&&e.source_language&&t.append("source_language",e.source_language);const a=t.toString()?`/api/video-collections?${t.toString()}`:"/api/video-collections";return await this.request(a,{method:"GET"})}async getVideoCollection(e){return this.logger.debug("getVideoCollection() called with:",{collectionId:e}),await this.request(`/api/video-collections/${e}`,{method:"GET"})}async deleteVideoCollection(e){this.logger.debug("deleteVideoCollection() called with:",{collectionId:e}),await this.request(`/api/video-collections/${e}`,{method:"DELETE"},1)}async request(e,t,a=3){const r=`${this.baseUrl}${e}`;this.accessToken&&(t.headers={...t.headers,Authorization:`Bearer ${this.accessToken}`});for(let s=1;s<=a;s++)try{this.logger.debug(`Request attempt ${s}/${a} to ${r}`);const i=await fetch(r,t);if(!i.ok){const l=await i.text().catch(()=>"Unknown error");throw new Error(`HTTP ${i.status} ${i.statusText}: ${l}`)}if(i.status===204){this.logger.debug(`Request successful on attempt ${s} (204 No Content)`);return}const c=await i.json();return this.logger.debug(`Request successful on attempt ${s}`),c}catch(i){const c=i instanceof Error?i.message:String(i);if(this.logger.warn(`Request failed (attempt ${s}/${a}):`,c),s===a)throw this.logger.error(`All ${a} attempts failed for ${r}`),new Error(`API request failed after ${a} attempts: ${c}`);const l=Math.pow(2,s-1)*1e3;this.logger.debug(`Waiting ${l}ms before retry...`),await new Promise(C=>setTimeout(C,l))}throw new Error("Unexpected error in request handler")}async loadTokensFromStorage(){try{const e=await chrome.storage.local.get(["access_token","refresh_token","token_expires_at","cached_user"]);this.accessToken=e.access_token||null,this.refreshToken=e.refresh_token||null,this.tokenExpiresAt=e.token_expires_at||null,this.cachedUser=e.cached_user||null,this.accessToken&&this.logger.info("Tokens loaded from storage"),this.cachedUser&&this.logger.info("Cached user loaded from storage")}catch(e){this.logger.error("Failed to load tokens from storage:",e)}}async setTokens(e){this.accessToken=e.access_token,this.refreshToken=e.refresh_token,this.tokenExpiresAt=Date.now()+e.expires_in*1e3;try{await chrome.storage.local.set({access_token:this.accessToken,refresh_token:this.refreshToken,token_expires_at:this.tokenExpiresAt}),this.logger.info("Tokens stored successfully")}catch(t){throw this.logger.error("Failed to store tokens:",t),t}}async clearTokens(){this.accessToken=null,this.refreshToken=null,this.tokenExpiresAt=null,this.cachedUser=null;try{await chrome.storage.local.remove(["access_token","refresh_token","token_expires_at","cached_user"]),this.logger.info("Tokens and cached user cleared")}catch(e){this.logger.error("Failed to clear tokens:",e)}}async cacheUser(e){this.cachedUser=e;try{await chrome.storage.local.set({cached_user:e}),this.logger.info("User cached successfully")}catch(t){this.logger.error("Failed to cache user:",t)}}isTokenExpired(){return this.tokenExpiresAt?Date.now()>=this.tokenExpiresAt-6e4:!0}};o(u,"instance");let w=u;class E{constructor(e,t){this.apiClient=e,this.logger=t}canHandle(e){return[n.CHECK_AUTH,n.AUTH_LOGIN,n.AUTH_LOGOUT,n.AUTH_REGISTER,n.AUTH_GET_USER].includes(e)}async handleContentScriptCheckAuth(e){try{await this.apiClient.waitForInitialization();const t=await this.apiClient.isAuthenticated();e({source:h.BACKGROUND,type:n.CHECK_AUTH_RESPONSE,data:{authenticated:t},timestamp:Date.now()})}catch(t){this.logger.error("Failed to check authentication:",t),e({source:h.BACKGROUND,type:n.CHECK_AUTH_RESPONSE,data:{authenticated:!1},timestamp:Date.now()})}}async handlePopupCheckAuth(e){try{await this.apiClient.waitForInitialization();const t=await this.apiClient.isAuthenticated();let a=null;t&&(a=this.apiClient.getCachedUser()||await this.apiClient.getCurrentUser()),e({source:h.BACKGROUND,type:n.CHECK_AUTH_RESPONSE,data:{authenticated:t,user:a},timestamp:Date.now()})}catch(t){this.logger.error("Failed to check authentication:",t),e({source:h.BACKGROUND,type:n.CHECK_AUTH_RESPONSE,data:{authenticated:!1},timestamp:Date.now()})}}async handleLogin(e,t){try{await this.apiClient.login(e);const a=await this.apiClient.getCurrentUser();t({success:!0,user:a}),this.broadcastAuthStateChange(!0)}catch(a){const r=a instanceof Error?a.message:"Login failed";this.logger.error("Login failed:",a),t({success:!1,error:r})}}async handleLogout(e){try{await this.apiClient.logout(),e({success:!0}),this.broadcastAuthStateChange(!1)}catch(t){const a=t instanceof Error?t.message:"Logout failed";this.logger.error("Logout failed:",t),e({success:!1,error:a})}}async handleRegister(e,t){try{const a=await this.apiClient.register(e);t({success:!0,user:a})}catch(a){const r=a instanceof Error?a.message:"Registration failed";this.logger.error("Registration failed:",a),t({success:!1,error:r})}}async handleGetUser(e){try{if(await this.apiClient.waitForInitialization(),!await this.apiClient.isAuthenticated()){e({success:!1,error:"Not authenticated"});return}const a=this.apiClient.getCachedUser()||await this.apiClient.getCurrentUser();e({success:!0,user:a})}catch(t){const a=t instanceof Error?t.message:"Failed to get user";this.logger.error("Failed to get user:",t),e({success:!1,error:a})}}broadcastAuthStateChange(e){chrome.tabs.query({url:"*://*.youtube.com/*"},t=>{this.logger.debug(`Broadcasting auth state change to ${t.length} YouTube tabs`),t.forEach(a=>{a.id&&chrome.tabs.sendMessage(a.id,{source:h.BACKGROUND,type:n.AUTH_STATE_CHANGED,data:{authenticated:e},timestamp:Date.now()})})})}}class L{constructor(e,t,a){this.apiClient=e,this.collectionManager=t,this.logger=a}canHandle(e){return[n.COLLECTION_LOAD,n.COLLECTION_CREATE,n.COLLECTION_REMOVE,n.COLLECTION_CHECK,n.COLLECTION_GET_LEMMAS].includes(e)}async handleLoad(e,t){try{const a=await this.collectionManager.loadCollections(e.videoViewId,e.sourceLang);t({collections:a})}catch(a){this.logger.error("Failed to load collections:",a),t({collections:[],error:a instanceof Error?a.message:"Failed to load collections"})}}async handleCreate(e,t){var a;try{const r=await this.apiClient.createVideoCollection(e.request);this.logger.info(`Collection created: id=${r.id}, word=${e.request.word}`);const s={id:r.id,word:e.request.word,lemma:((a=e.request.lemma)==null?void 0:a.toLowerCase())??null,segmentBegin:e.request.segment_begin};this.collectionManager.addCollection(e.request.video_view_id,s),t({success:!0,collection:r})}catch(r){this.logger.error("Failed to create collection:",r),t({success:!1,error:r instanceof Error?r.message:"Failed to create collection"})}}async handleRemove(e,t){try{await this.apiClient.deleteVideoCollection(e.collectionId);const a=e.videoViewId===0?null:e.videoViewId;this.collectionManager.removeCollection(a,e.collectionId),t({success:!0})}catch(a){this.logger.error("Failed to remove collection:",a),t({success:!1,error:a instanceof Error?a.message:"Failed to remove collection"})}}handleCheck(e,t){const a=this.collectionManager.isWordCollected(e.videoViewId,e.word,e.segmentBegin);if(e.returnId){const r=this.collectionManager.getCollectionId(e.videoViewId,e.word,e.segmentBegin);t({collected:a,collectionId:r})}else t({collected:a})}handleGetLemmas(e,t){const a=this.collectionManager.getCollectedLemmas(e.videoViewId);t({lemmas:Array.from(a)})}}const d=class d{constructor(e){o(this,"logger",new T("[CollectionManager]"));o(this,"apiClient");o(this,"cache",new Map);this.apiClient=e}static getInstance(e){return d.instance||(d.instance=new d(e)),d.instance}async loadCollections(e,t){this.logger.debug(`Loading collections for videoViewId=${e}, sourceLang=${t}`);try{const a=await this.apiClient.getVideoCollections({video_view_id:e,source_language:t,limit:1e3}),r=new Map,s=[];for(const i of a.items){const c={id:i.id,word:i.word,lemma:i.lemma?i.lemma.toLowerCase():null,segmentBegin:i.segment_begin},l=this.getCacheKey(i.word,i.segment_begin);r.set(l,c),s.push(c)}return this.cache.set(e,r),this.logger.info(`Loaded ${s.length} collections for videoViewId=${e}`),s}catch(a){throw this.logger.error(`Failed to load collections for videoViewId=${e}:`,a),a}}addCollection(e,t){let a=this.cache.get(e);a||(a=new Map,this.cache.set(e,a));const r=this.getCacheKey(t.word,t.segmentBegin);a.set(r,t),this.logger.debug(`Added collection: videoViewId=${e}, word=${t.word}, id=${t.id}`),this.broadcast(n.COLLECTION_ADDED,{videoViewId:e,collection:t})}removeCollection(e,t){let a;if(e!==null){const s=this.cache.get(e);if(!s){this.logger.warn(`No cache found for videoViewId=${e}`);return}a=[[e,s]]}else a=Array.from(this.cache.entries());for(const[s,i]of a)for(const[c,l]of i.entries())if(l.id===t){i.delete(c),this.logger.debug(`Removed collection: videoViewId=${s}, collectionId=${t}`);const C={videoViewId:s,collectionId:t,word:l.word,lemma:l.lemma};this.broadcast(n.COLLECTION_REMOVED,C);return}const r=e!==null?`videoViewId=${e}`:"all caches";this.logger.warn(`Collection not found in ${r}: collectionId=${t}`)}isWordCollected(e,t,a){const r=this.cache.get(e);if(!r)return!1;const s=this.getCacheKey(t,a);return r.has(s)}getCollectionId(e,t,a){var i;const r=this.cache.get(e);if(!r)return null;const s=this.getCacheKey(t,a);return((i=r.get(s))==null?void 0:i.id)??null}getCollectedLemmas(e){const t=new Set,a=this.cache.get(e);if(!a)return t;for(const r of a.values())r.lemma&&t.add(r.lemma);return t}clearCache(e){this.cache.delete(e),this.logger.debug(`Cleared cache for videoViewId=${e}`)}getCacheKey(e,t){return`${e.toLowerCase()}:${t}`}broadcast(e,t){chrome.tabs.query({url:"*://*.youtube.com/*"},a=>{for(const r of a)r.id&&chrome.tabs.sendMessage(r.id,{source:h.BACKGROUND,type:e,data:t,timestamp:Date.now()}).catch(()=>{})}),chrome.runtime.sendMessage({source:h.BACKGROUND,type:e,data:t,timestamp:Date.now()}).catch(()=>{})}};o(d,"instance",null);let m=d;const f={nativeLanguage:"zh-CN",targetLanguage:"en",interfaceLanguage:"zh_CN"};class k{constructor(e){this.logger=e}canHandle(e){return[n.SETTINGS_LOAD,n.SETTINGS_SAVE].includes(e)}async handleLoad(e){try{const t=await chrome.storage.sync.get(["nativeLanguage","targetLanguage","interfaceLanguage"]),a={nativeLanguage:t.nativeLanguage||f.nativeLanguage,targetLanguage:t.targetLanguage||f.targetLanguage,interfaceLanguage:t.interfaceLanguage||f.interfaceLanguage};this.logger.debug("Loaded settings:",a),e({success:!0,settings:a})}catch(t){this.logger.error("Failed to load settings:",t),e({success:!1,error:t instanceof Error?t.message:"Failed to load settings"})}}async handleSave(e,t){try{const{settings:a}=e,r=await chrome.storage.sync.get(["nativeLanguage","targetLanguage","interfaceLanguage"]),s={nativeLanguage:r.nativeLanguage||f.nativeLanguage,targetLanguage:r.targetLanguage||f.targetLanguage,interfaceLanguage:r.interfaceLanguage||f.interfaceLanguage},i=[];for(const l of Object.keys(a))a[l]!==void 0&&a[l]!==s[l]&&i.push(l);const c={...s,...a};await chrome.storage.sync.set({nativeLanguage:c.nativeLanguage,targetLanguage:c.targetLanguage,interfaceLanguage:c.interfaceLanguage}),this.logger.debug("Saved settings:",c,"Changed keys:",i),t({success:!0,settings:c}),i.length>0&&this.broadcastSettingsChange(c,i)}catch(a){this.logger.error("Failed to save settings:",a),t({success:!1,error:a instanceof Error?a.message:"Failed to save settings"})}}broadcastSettingsChange(e,t){chrome.tabs.query({url:"*://*.youtube.com/*"},a=>{this.logger.debug(`Broadcasting settings change to ${a.length} YouTube tabs. Changed: ${t.join(", ")}`);const r={settings:e,changedKeys:t};a.forEach(s=>{s.id&&chrome.tabs.sendMessage(s.id,{source:h.BACKGROUND,type:n.SETTINGS_CHANGED,data:r,timestamp:Date.now()})})})}}class _{constructor(){o(this,"logger",new T("[Background]"));o(this,"nativeLng","zh-CN");o(this,"apiClient");o(this,"authHandler");o(this,"collectionHandler");o(this,"settingsHandler");this.apiClient=w.getInstance(),this.authHandler=new E(this.apiClient,this.logger);const e=m.getInstance(this.apiClient);this.collectionHandler=new L(this.apiClient,e,this.logger),this.settingsHandler=new k(this.logger),this.setupMessageListeners()}setupMessageListeners(){chrome.runtime.onMessage.addListener((e,t,a)=>e.source===h.CONTENT_SCRIPT?this.handleContentScriptMessage(e,t,a):e.source===h.POPUP?this.handlePopupMessage(e,t,a):(this.logger.warn(`Unknown message source: ${e.source}`),!1))}handleContentScriptMessage(e,t,a){switch(e.type){case n.TRANSLATE_REQUEST:return this.handleTranslateRequest(e.data,a),!0;case n.PHRASE_EXTRACT_REQUEST:return this.handlePhraseExtractRequest(e.data,a),!0;case n.COLLECTION_LOAD:return this.collectionHandler.handleLoad(e.data,a),!0;case n.COLLECTION_CREATE:return this.collectionHandler.handleCreate(e.data,a),!0;case n.COLLECTION_REMOVE:return this.collectionHandler.handleRemove(e.data,a),!0;case n.COLLECTION_CHECK:return this.collectionHandler.handleCheck(e.data,a),!0;case n.COLLECTION_GET_LEMMAS:return this.collectionHandler.handleGetLemmas(e.data,a),!0;case n.CHECK_AUTH:return this.authHandler.handleContentScriptCheckAuth(a),!0;case n.OPEN_POPUP:this.openPopup();break;case n.API_CALL:return this.handleAPICall(e.data,a),!0;default:this.logger.warn(`Unknown content script message type: ${e.type}`);break}return!1}handlePopupMessage(e,t,a){switch(e.type){case n.AUTH_LOGIN:return this.authHandler.handleLogin(e.data,a),!0;case n.AUTH_LOGOUT:return this.authHandler.handleLogout(a),!0;case n.AUTH_REGISTER:return this.authHandler.handleRegister(e.data,a),!0;case n.AUTH_GET_USER:return this.authHandler.handleGetUser(a),!0;case n.CHECK_AUTH:return this.authHandler.handlePopupCheckAuth(a),!0;case n.SETTINGS_LOAD:return this.settingsHandler.handleLoad(a),!0;case n.SETTINGS_SAVE:return this.settingsHandler.handleSave(e.data,a),!0;case n.NATIVE_LANGUAGE_CHANGE:this.handleNativeLanguageChange(e.data.nativeLng);break;case n.GET_SUBTITLE_DATA:a({source:h.BACKGROUND,type:n.GET_SUBTITLE_DATA_RESPONSE,data:{subtitleData:null,message:"Background is stateless. Subtitle data is managed by Content Script."},timestamp:Date.now()});break;case n.COLLECTION_REMOVE:return this.collectionHandler.handleRemove(e.data,a),!0;case n.API_CALL:return this.handleAPICall(e.data,a),!0;default:this.logger.warn(`Unknown popup message type: ${e.type}`)}return!1}async handleTranslateRequest(e,t){const{segments:a,sourceLng:r,targetLng:s}=e;try{const i=await this.apiClient.translate({segments:a,source_lng:r,target_lng:s});if(i.segments.length!==a.length)throw new Error(`Translation count mismatch: expected ${a.length}, got ${i.segments.length}`);t({success:!0,segments:i.segments})}catch(i){this.logger.error("Translation request failed:",i),t({success:!1,error:i instanceof Error?i.message:"Translation failed"})}}async handlePhraseExtractRequest(e,t){const{texts:a,language:r,nativeLng:s}=e;try{const i=await this.apiClient.extractPhrases({texts:a,language:r,native_lng:s});t({success:!0,phrases:i.phrases})}catch(i){this.logger.error("Phrase extraction request failed:",i),t({success:!1,error:i instanceof Error?i.message:"Phrase extraction failed"})}}openPopup(){(async()=>{try{await chrome.action.openPopup(),this.logger.debug("Popup opened successfully")}catch(e){this.logger.error("Failed to open popup:",e),chrome.tabs.create({url:chrome.runtime.getURL("popup.html")})}})()}handleNativeLanguageChange(e){this.nativeLng!==e&&(this.logger.debug(`Native language changed: ${this.nativeLng} â†’ ${e}`),this.nativeLng=e,chrome.tabs.query({url:"*://*.youtube.com/*"},t=>{this.logger.debug(`Broadcasting language change to ${t.length} YouTube tabs`),t.forEach(a=>{a.id&&chrome.tabs.sendMessage(a.id,{source:h.BACKGROUND,type:n.NATIVE_LANGUAGE_CHANGE,data:{nativeLng:e},timestamp:Date.now()})})}))}async handleAPICall(e,t){const{method:a,args:r}=e;try{await this.apiClient.waitForInitialization();const s=this.apiClient[a];if(typeof s!="function")throw new Error(`Unknown API method: ${a}`);const i=await s.apply(this.apiClient,r);t({success:!0,data:i})}catch(s){this.logger.error(`API call '${a}' failed:`,s),t({success:!1,error:s instanceof Error?s.message:"API call failed"})}}}new _;
