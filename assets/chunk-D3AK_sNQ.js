import{a as t,M as c}from"./chunk-DwgIagi8.js";const h=["en","zh-CN","zh-TW","ja","ko","es","fr","de"],L=["en","zh_CN","zh_TW","ja","ko","es","fr","de"];function T(e){return L.includes(e)}function w(e){return`languages_${e.replace("-","")}`}function p(e){const s=w(e),n=N(s);return n!==s?n:e}function y(e){return e.replace("_","-")}const l="en",f="interfaceLanguage";let o={},a=l,u=l;async function A(){const e=chrome.i18n.getUILanguage(),s=O(e);u=T(s)?s:l;const r=(await chrome.storage.sync.get([f]))[f];r&&T(r)?a=r:a=u,await Promise.all([C(u),C(a)])}async function C(e){if(!o[e])try{const s=chrome.runtime.getURL(`_locales/${e}/messages.json`),r=await(await fetch(s)).json();o[e]=r}catch(s){console.error(`[i18n] Failed to load messages for locale: ${e}`,s),e!==l&&await C(l)}}function O(e){return e.replace("-","_")}function N(e,s){const n=o[a]||o[l];if(!n)return console.warn(`[i18n] No messages loaded for locale: ${a}, cache keys:`,Object.keys(o)),e;if(!n[e])return console.warn(`[i18n] Missing translation key: ${e} for locale: ${a}`,`Available keys: ${Object.keys(n).length}`),e;let r=n[e].message;return s&&(Array.isArray(s)?s:[s]).forEach((g,m)=>{r=r.replace(`$${m+1}`,g)}),r}function S(e,s){const n=o[u]||o[l];return n?n[e]?n[e].message:(console.warn(`[i18n] Missing translation key: ${e} for browser locale: ${u}`,`Available keys: ${Object.keys(n).length}`),e):(console.warn(`[i18n] No messages loaded for browser locale: ${u}, cache keys:`,Object.keys(o)),e)}function $(){return a}async function P(e){if(!T(e)){console.error(`[i18n] Unsupported locale: ${e}`);return}a=e,await chrome.storage.sync.set({[f]:e}),await C(e)}const _=1e4;function i(e,s,n={},r=_){return new Promise((d,g)=>{const m=setTimeout(()=>{g(new Error(`Message ${s} timed out after ${r}ms`))},r);chrome.runtime.sendMessage({source:e,type:s,data:n,timestamp:Date.now()},E=>{clearTimeout(m),chrome.runtime.lastError?g(new Error(chrome.runtime.lastError.message||"Unknown error")):d(E)})})}function M(e,s,n={}){chrome.runtime.sendMessage({source:e,type:s,data:n,timestamp:Date.now()})}async function R(e,...s){const n=t.CONTENT_SCRIPT,r=await i(n,c.API_CALL,{method:e,args:s});if(!(r!=null&&r.success))throw new Error((r==null?void 0:r.error)||`API call '${e}' failed`);return r.data}const b={async loadCollections(e,s){return(await i(t.CONTENT_SCRIPT,c.COLLECTION_LOAD,{videoViewId:e,sourceLang:s})).collections},async removeCollection(e,s,n=t.CONTENT_SCRIPT){await i(n,c.COLLECTION_REMOVE,{videoViewId:s??0,collectionId:e})},async isWordCollected(e,s,n){return(await i(t.CONTENT_SCRIPT,c.COLLECTION_CHECK,{videoViewId:e,word:s,segmentBegin:n})).collected},async getCollectionId(e,s,n){return(await i(t.CONTENT_SCRIPT,c.COLLECTION_CHECK,{videoViewId:e,word:s,segmentBegin:n,returnId:!0})).collectionId},async getCollectedLemmas(e){const s=await i(t.CONTENT_SCRIPT,c.COLLECTION_GET_LEMMAS,{videoViewId:e});return new Set(s.lemmas)},async createCollection(e){const s=await i(t.CONTENT_SCRIPT,c.COLLECTION_CREATE,{request:e});if(!s.success||!s.collection)throw new Error(s.error||"Failed to create collection");return s.collection}};export{b as C,h as S,i as a,N as b,R as c,P as d,L as e,$ as f,p as g,A as i,y as l,M as s,S as t};
